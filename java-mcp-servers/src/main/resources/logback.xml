<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <!-- Console appender with structured JSON-like output -->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- Structured appender for verbose mode -->
    <appender name="VERBOSE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{yyyy-MM-dd'T'HH:mm:ss.SSSXXX} %-5level [%thread] %logger{50} - %msg%n%ex{full}</pattern>
        </encoder>
    </appender>

    <!-- Logger for MCP servers -->
    <logger name="com.llmagents.mcp" level="INFO" additivity="false">
        <appender-ref ref="CONSOLE"/>
    </logger>

    <!-- Logger for MCP SDK -->
    <logger name="io.github.modelcontextprotocol" level="INFO" additivity="false">
        <appender-ref ref="CONSOLE"/>
    </logger>

    <!-- Logger for Jetty (reduce noise) -->
    <logger name="org.eclipse.jetty" level="WARN" additivity="false">
        <appender-ref ref="CONSOLE"/>
    </logger>

    <!-- Root logger -->
    <root level="INFO">
        <appender-ref ref="CONSOLE"/>
    </root>

    <!-- Enable verbose mode via system property: -Dlogback.verbose=true -->
    <if condition='property("logback.verbose").contains("true")'>
        <then>
            <logger name="com.llmagents.mcp" level="DEBUG" additivity="false">
                <appender-ref ref="VERBOSE"/>
            </logger>
            <root level="DEBUG">
                <appender-ref ref="VERBOSE"/>
            </root>
        </then>
    </if>
</configuration>
